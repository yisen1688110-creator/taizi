import { createContext, useContext, useMemo, useState, useEffect } from "react";

const translations = {
  es: {
    appLang: "EspaÃ±ol (MÃ©xico)",
    switchTo: "Switch to English",
    loginTitle: "Bienvenido",
    phone: "TelÃ©fono",
    email: "Correo",
    password: "ContraseÃ±a",
    placeholderPhone: "Introduzca un nÃºmero de 10 dÃ­gitos",
    placeholderEmail: "Introduzca su correo",
    placeholderPassword: "Introduzca la contraseÃ±a",
    submitLogin: "Iniciar sesiÃ³n",
    registerLink: "Â¿No tienes cuenta? RegÃ­strate",
    errorPhone: "Ingrese un nÃºmero de 10 dÃ­gitos",
    errorEmail: "Correo invÃ¡lido",
    errorPassword: "La contraseÃ±a debe tener al menos 6 caracteres",

    registerTitle: "Registro",
    name: "Nombre",
    placeholderName: "Introduzca su nombre",
    confirmPassword: "Confirmar contraseÃ±a",
    placeholderConfirm: "Vuelva a introducir la contraseÃ±a",
    submitRegister: "Registrarse",
    loginLink: "Â¿Ya tienes cuenta? Inicia sesiÃ³n",
    errorRegistered: "Este nÃºmero ya estÃ¡ registrado",
    errorConfirmMismatch: "Las contraseÃ±as no coinciden",
    successRegister: "Registro exitoso (demo)",
    loginNotFound: "NÃºmero no encontrado",
    loginWrongPassword: "ContraseÃ±a incorrecta",

    adminTitle: "Panel de administraciÃ³n",
    adminDesc: "Gestione usuarios registrados, bÃºsqueda y detalles.",

    // æ–°å¢žåŽå°æ–‡æ¡ˆ
    adminUsers: "Usuarios registrados",
    adminStatsLabel: "Resumen",
    search: "Buscar",
    placeholderSearch: "Buscar nombre o telÃ©fono",
    filterRole: "Rol",
    roleAll: "Todos",
    roleCustomer: "Cliente",
    roleOperator: "Operador",
    roleAdmin: "Administrador",
    roleSuper: "Super administrador",
    filterAssign: "AsignaciÃ³n",
    assignAll: "Todos",
    assignAssigned: "Asignado",
    assignUnassigned: "Sin asignaciÃ³n",
    detailsTitle: "Detalles del usuario",
    changePassword: "Cambiar contraseÃ±a",
    placeholderNewPassword: "Nueva contraseÃ±a",
    saveChanges: "Guardar cambios",
    cancel: "Cancelar",
    noAccessTitle: "Sin acceso",
    noAccessDesc: "Solo personal puede acceder a esta pÃ¡gina.",
    passwordUpdated: "ContraseÃ±a actualizada",

    // Home page translations
    recharge: "Recargar",
    swap: "Intercambiar",
    goToMarket: "Ir al mercado",
    marketOverviewTitle: "Resumen del mercado",
    marketMX: "MÃ©xico",
    marketUS: "Estados Unidos", 
    marketCrypto: "Criptomonedas",
    // Home wallet
    walletBalanceTitle: "Saldo de la billetera",
    assetsLabel: "Activos: MXN, USD, USDT",
    // Home ads and popular section
    adsTitle: "Anuncio",
    adsDesc: "Espacio de publicidad",
    popularByVolumeTitle: "Popular por volumen",
    sort: "Ordenar",
    sortByTurnover: "Por volumen",
    sortByMomentum: "Por impulso",
    
    // Bottom navigation
    bottomHome: "Inicio",
    bottomMarket: "Mercado",
    bottomSwap: "Intercambio",
    bottomTrade: "Operar",
    bottomNotify: "Notificaciones",
    bottomMe: "Perfil",
    
    // Market page translations
    marketPageTitle: "Mercado",
    tabMarket: "Mercado",
    tabNews: "Noticias",
    labelMarket: "Mercado",
    labelView: "Vista",
    labelCurrency: "Moneda",
    viewOverview: "Resumen",
    viewTopGainers: "MÃ¡s ganadores",
    viewTopLosers: "MÃ¡s perdedores", 
    viewTurnover: "Volumen",
    stocksTitle: "Acciones MX",
    stocksTitleUS: "Acciones US",
    searchMX: "Buscar acciones MX",
    searchUS: "Buscar acciones US", 
    searchCrypto: "Buscar criptomonedas",
    placeholderMX: "Ej: WALMEX, CEMEX",
    placeholderUS: "Ej: AAPL, TSLA",
    placeholderCrypto: "Ej: Bitcoin, Ethereum",
    addFav: "Agregar a favoritos",
    removeFav: "Quitar de favoritos",
    
    // Swap page translations
    swapTitle: "Intercambio",
    swapDesc: "Intercambie entre diferentes monedas y criptomonedas",
    swapSupportDesc: "Soporta intercambio entre MXN, USD y USDT (USDT 1:1 USD)",
    labelFrom: "Desde",
    labelTo: "A",
    labelAmount: "Importe",
    placeholderAmountMXN: "Ej: 1000",
    placeholderAmountUSD: "Ej: 100",
    placeholderAmountUSDT: "Ej: 100",
    estimatedReceive: "Recibir estimado",
    btnBack: "Volver",
    btnSwap: "Intercambiar",
    errorAmountInvalid: "Ingrese un importe vÃ¡lido",
    errorRateUnavailable: "Tipo de cambio no disponible",
    errorBalanceInsufficientMXN: "Saldo MXN insuficiente",
    errorBalanceInsufficientUSD: "Saldo USD insuficiente",
    errorBalanceInsufficientUSDT: "Saldo USDT insuficiente",
    successSwap: "Intercambio exitoso",
    rateTimeLabel: "Hora de tasa",
    currentUSDBalance: "Saldo USD actual",
    currentUSDTBalance: "Saldo USDT actual",
    // Trading panel
    portfolioTitle: "Mis posiciones",
    positionsEmpty: "Sin posiciones",
    ordersEmpty: "Sin Ã³rdenes",
    symbol: "SÃ­mbolo",
    qty: "Cantidad",
    avgPrice: "Precio medio",
    pnl: "Ganancia/PÃ©rdida",
    pnlPct: "Gan/PÃ©rdida(%)",
    long: "Largo",
    short: "Corto",
    buy: "Comprar",
    sell: "Vender",
    marketPrice: "Precio de mercado",
    limitPrice: "Precio lÃ­mite",
    shares: "Acciones",
    placeholderShares: "Ingrese cantidad",
    price: "Precio",
    placeholderLimitPrice: "Ingrese precio lÃ­mite",
    status: "Estado",
    filled: "Completada",
    waitingFill: "Esperando",
    limitTooHigh: "El precio lÃ­mite no puede ser mayor que el precio actual",
    limitTooLow: "El precio lÃ­mite no puede ser menor que el precio actual",
    bottomNote: "(Esta es la navegaciÃ³n inferior)",
    orderSubmitted: "Orden enviada",
    successBuy: "Compra realizada",
    sellRestrictedBeforeListing: "Venta restringida antes de cotizar",
    // Trades panel
    trades: "Operaciones",
    tradesEmpty: "Sin operaciones",
    buyTime: "Hora de compra",
    sellTime: "Hora de venta",
    amount: "Importe",
    side: "DirecciÃ³n",
    time: "Hora",
    close: "Cerrar",

    // 404
    notFoundTitle: "404",
    notFoundDesc: "PÃ¡gina no encontrada",
    
    // Kçº¿å›¾ç›¸å…³
    klineOpen: "Abrir",
    klineHigh: "Alto",
    klineLow: "Bajo",
    klineClose: "Cerrar",
    klineVolume: "Volumen",
    klineCandlestick: "Velas",
    klineLine: "LÃ­nea",
    klineFullscreen: "Pantalla completa",
    klineSettings: "ConfiguraciÃ³n",
    // Settings page labels
    nameLabel: "Nombre",
    phoneLabel: "TelÃ©fono",
    loginPwdLabel: "ContraseÃ±a de inicio de sesiÃ³n",
    tradePwdLabel: "PIN de transacciÃ³n",
    kycTitle: "VerificaciÃ³n",
    languageLabel: "Idioma",
    changeLabel: "Cambiar",
    settingsTitle: "ConfiguraciÃ³n de la cuenta",
    // Settings extras
    btnBackProfile: "Volver al perfil",
    // Institution page
    institutionTitle: "Cuenta institucional",
    institutionDesc: "Administre cuentas de empresa: KYC, lÃ­mites, permisos y contactos.",
    institutionOrgName: "Nombre de la empresa",
    institutionOrgIntro: "DescripciÃ³n de la empresa",
    institutionFundsTitle: "Fondos de cuenta",
    institutionEntriesTitle: "Accesos rÃ¡pidos",
    institutionBankEntry: "Bancos",
    institutionTradeEntry: "Trading",
    institutionIPOEntry: "IPO",
    institutionSecurityEntry: "Seguridad",
    institutionKycTitle: "Estado KYC",
    institutionKycPending: "Pendiente de verificaciÃ³n",
    institutionKycVerified: "Verificado",
    institutionFeatureFund: "Fondos",
    institutionFeatureBlock: "Operaciones grandes",
    institutionFeatureIPORWA: "IPO/RWA",
    institutionTabHoldings: "PosiciÃ³n actual",
    institutionTabCompleted: "Completado",
    btnRequestUpgrade: "Solicitar mejora",
    btnAddContact: "Agregar contacto",
    labelCorporateName: "Empresa",
    changeNameTitle: "Cambiar nombre",
    currentPassword: "ContraseÃ±a actual",
    confirm: "Confirmar",
    saving: "Guardando...",
    changeTradePinTitle: "Cambiar PIN de transacciÃ³n",
    verifyWithLoginPassword: "Ingrese contraseÃ±a para verificar",
    placeholderNewPin: "Nuevo PIN",
    chooseLanguage: "Seleccionar idioma",
    langSwitchInstant: "El cambio surte efecto inmediatamente",
    langSpanish: "EspaÃ±ol",
    langEnglish: "InglÃ©s",
    // Settings error/success
    errorNameLength: "El nombre debe tener 2-20 caracteres",
    successNameUpdated: "Nombre actualizado",
    errorNameSaveFailed: "Error al guardar el nombre, intÃ©ntelo de nuevo",
    errorOldPasswordWrong: "ContraseÃ±a actual incorrecta",
    errorNewPasswordLength: "La nueva contraseÃ±a debe tener al menos 6 caracteres",
    successLoginPasswordUpdated: "ContraseÃ±a actualizada",
    errorLoginPasswordUpdate: "Error al actualizar la contraseÃ±a",
    errorLoginVerifyFailed: "FallÃ³ la verificaciÃ³n de contraseÃ±a",
    errorTradePinLength: "El PIN debe tener 6 dÃ­gitos",
    successTradePinUpdated: "PIN de transacciÃ³n actualizado",
    errorTradePinUpdate: "Error al actualizar el PIN",
    // Settings modal hints
    hintLoginPwdModal: "La nueva contraseÃ±a debe tener al menos 6 caracteres.",
    hintTradePinModal: "PIN de 6 dÃ­gitos, verifique con contraseÃ±a de inicio de sesiÃ³n.",

    // Bank cards
    bankCardsTitle: "Tarjetas bancarias vinculadas",
    bankCardsDesc: "Administre sus tarjetas solo para retiros.",
    bankCardsHint: "Solo para retiros; no se puede pagar en lÃ­nea.",
    addBankCard: "Agregar tarjeta",
    cardNumber: "NÃºmero de tarjeta/CLABE",
    holderName: "Nombre del titular",
    bankName: "Banco",
    placeholderCardNumber: "Ingrese nÃºmero de tarjeta/CLABE",
    placeholderHolderName: "Ingrese el nombre del titular aquÃ­",
    placeholderBankName: "Ingrese el nombre del banco aquÃ­",
    hintBankNameInput: "",
    addCardHint: "Ingrese nÃºmero de tarjeta/CLABE (15, 16 o 18 dÃ­gitos).",
    errorCardNumber: "NÃºmero invÃ¡lido (MÃ©xico: 15, 16 o 18 dÃ­gitos)",
    errorHolderName: "Nombre del titular invÃ¡lido",
    errorBankName: "Seleccione un banco",
    successCardAdded: "Tarjeta agregada",
    edit: "Editar",
    delete: "Eliminar",
    confirmDeleteTitle: "Confirmar eliminaciÃ³n",
    confirmDeleteDesc: "Â¿Desea eliminar esta tarjeta?",
    confirmYes: "SÃ­",
    confirmNo: "No",
    successCardUpdated: "Tarjeta actualizada",
    successCardDeleted: "Tarjeta eliminada",
    errorUpdateFailed: "Error al actualizar",
    errorDeleteFailed: "Error al eliminar",

    // Wallet addresses
    walletsTitle: "DirecciÃ³n de billetera",
    walletsDesc: "Vincule su direcciÃ³n de criptomonedas para retiros",
    walletAddressLabel: "DirecciÃ³n",
    walletsListTitle: "Direcciones guardadas",
    // Wallet relaxed validation prompts
    errorInvalidAddress: "DirecciÃ³n invÃ¡lida (debe estar llena)",
    editAddressPrompt: "Editar direcciÃ³n",
    editNetworkPrompt: "Red (ERC20/TRC20)",
    confirmDeleteAddress: "Â¿Eliminar esta direcciÃ³n?",
    // Global error and chart translations
    globalErrorTitle: "Se produjo un error",
    errorUnknown: "Error desconocido",
    btnRetry: "Reintentar",
    btnClearCacheReload: "Borrar cachÃ© y recargar",
    chartInitializing: "Inicializando grÃ¡fico...",
    chartUnavailableTitle: "Datos del grÃ¡fico no disponibles",
    chartUnavailableMessage: "El sÃ­mbolo o los datos del grÃ¡fico no estÃ¡n disponibles temporalmente.",
    btnTryYahoo: "Probar Yahoo Finance",
    fallbackReasonYahooMexico: "ðŸ“Š Usando datos de Yahoo Finance (fuente dedicada a MÃ©xico)",
    fallbackReasonYahooUnavailable: "ðŸ“Š Usando datos de Yahoo Finance (TradingView no disponible)",
    fallbackReasonNativeFallback: "ðŸ“Š Usando grÃ¡fico nativo (regresÃ³ de TradingView)",
    btnTryTradingView: "Intentar TradingView",
    // Market table headings
    biggestUpsideTitle: "Mayor potencial al alza",
    trend: "Tendencia",
    change24h: "Cambio 24h",
    volume: "Volumen",
    // --- Institution page (new keys used by /me/institution) ---
    instTitle: "Cuenta institucional",
    instIntro: "Este bloque muestra la presentaciÃ³n de la empresa",
    instOrgNameDefault: "Nombre de la empresa",
    instOrgDescDefault: "DescripciÃ³n de la empresa",
    instFunds: "Fondos",
    instBlocks: "Operaciones grandes",
    instIpoRwa: "IPO/RWA",
    instPositionsCurrent: "PosiciÃ³n actual",
    instPositionsDone: "Completado",
    instPositionsEmpty: "Sin datos aÃºn",
    // Locking
    locked: "Bloqueado",
    lock: "Bloquear",
    unlock: "Desbloquear",
    lockSuccess: "Bloqueo activado",
    unlockSuccess: "Bloqueo retirado",
    lockFailed: "Error al bloquear",
    unlockFailed: "Error al desbloquear",
    // Invite code modal
    inviteTitle: "Ingrese su cÃ³digo de invitaciÃ³n institucional",
    invitePlaceholder: "Ingrese su cÃ³digo de invitaciÃ³n",
    inviteCancel: "Cancelar",
    inviteSubmit: "Confirmar",
    inviteInvalid: "CÃ³digo invÃ¡lido",
    inviteAlready: "Ya desbloqueado",
  },
  en: {
    appLang: "English",
    switchTo: "Cambiar a EspaÃ±ol",
    loginTitle: "Welcome",
    phone: "Phone",
    email: "Email",
    password: "Password",
    placeholderPhone: "Enter 10-digit phone number",
    placeholderEmail: "Enter your email",
    placeholderPassword: "Enter password",
    submitLogin: "Log In",
    registerLink: "No account? Register",
    errorPhone: "Please enter 10 digits",
    errorEmail: "Invalid email",
    errorPassword: "Password must be at least 6 characters",

    registerTitle: "Register",
    name: "Name",
    placeholderName: "Enter your name",
    confirmPassword: "Confirm Password",
    placeholderConfirm: "Re-enter password",
    submitRegister: "Register",
    loginLink: "Already have an account? Log in",
    errorRegistered: "This phone is already registered",
    errorConfirmMismatch: "Passwords do not match",
    successRegister: "Registered successfully (demo)",
    loginNotFound: "Account not found",
    loginWrongPassword: "Wrong password",

    adminTitle: "Admin Panel",
    adminDesc: "Manage registered users, search, and details.",

    // New admin strings
    adminUsers: "Registered Users",
    adminStatsLabel: "Overview",
    search: "Search",
    placeholderSearch: "Search name or phone",
    filterRole: "Role",
    roleAll: "All",
    roleCustomer: "Customer",
    roleOperator: "Operator",
    roleAdmin: "Admin",
    roleSuper: "Super Admin",
    filterAssign: "Assignment",
    assignAll: "All",
    assignAssigned: "Assigned",
    assignUnassigned: "Unassigned",
    detailsTitle: "User Details",
    changePassword: "Change Password",
    placeholderNewPassword: "New password",
    saveChanges: "Save Changes",
    cancel: "Cancel",
    noAccessTitle: "No Access",
    noAccessDesc: "Only staff can access this page.",
    passwordUpdated: "Password updated",

    // Home page translations
    recharge: "Recharge",
    swap: "Swap",
    goToMarket: "Go to Market",
    marketOverviewTitle: "Market Overview",
    marketMX: "Mexico",
    marketUS: "United States",
    marketCrypto: "Cryptocurrency",
    // Home wallet
    walletBalanceTitle: "Wallet Balance",
    assetsLabel: "Assets: MXN, USD, USDT",
    // Home ads and popular section
    adsTitle: "Ads",
    adsDesc: "Advertising space",
    popularByVolumeTitle: "Popular By Volume",
    sort: "Sort",
    sortByTurnover: "By turnover",
    sortByMomentum: "By momentum",
    
    // Bottom navigation
    bottomHome: "Home",
    bottomMarket: "Market", 
    bottomSwap: "Swap",
    bottomTrade: "Trade",
    bottomNotify: "Notifications",
    bottomMe: "Profile",
    
    // Market page translations
    marketPageTitle: "Market",
    tabMarket: "Market",
    tabNews: "News",
    labelMarket: "Market",
    labelView: "View",
    labelCurrency: "Currency",
    viewOverview: "Overview",
    viewTopGainers: "Top Gainers",
    viewTopLosers: "Top Losers",
    viewTurnover: "Turnover",
    stocksTitle: "MX Stocks",
    stocksTitleUS: "US Stocks", 
    searchMX: "Search MX stocks",
    searchUS: "Search US stocks",
    searchCrypto: "Search cryptocurrencies",
    placeholderMX: "e.g. WALMEX, CEMEX",
    placeholderUS: "e.g. AAPL, TSLA",
    placeholderCrypto: "e.g. Bitcoin, Ethereum",
    addFav: "Add to favorites",
    removeFav: "Remove from favorites",
    
    // Swap page translations
    swapTitle: "Swap",
    swapDesc: "Exchange between different currencies and cryptocurrencies",
    swapSupportDesc: "Supports MXN, USD, USDT mutual exchange (USDT 1:1 USD)",
    labelFrom: "From",
    labelTo: "To",
    labelAmount: "Amount",
    placeholderAmountMXN: "e.g. 1000",
    placeholderAmountUSD: "e.g. 100",
    placeholderAmountUSDT: "e.g. 100",
    estimatedReceive: "Estimated receive",
    btnBack: "Back",
    btnSwap: "Swap",
    errorAmountInvalid: "Please enter a valid amount",
    errorRateUnavailable: "Exchange rate unavailable",
    errorBalanceInsufficientMXN: "Insufficient MXN balance",
    errorBalanceInsufficientUSD: "Insufficient USD balance",
    errorBalanceInsufficientUSDT: "Insufficient USDT balance",
    successSwap: "Swap successful",
    rateTimeLabel: "Rate time",
    currentUSDBalance: "Current USD balance",
    currentUSDTBalance: "Current USDT balance",
    // Trading panel
    portfolioTitle: "My Positions",
    positionsEmpty: "No positions",
    ordersEmpty: "No orders",
    symbol: "Symbol",
    qty: "Qty",
    avgPrice: "Avg Price",
    pnl: "PnL",
    pnlPct: "PnL(%)",
    long: "Long",
    short: "Short",
    buy: "Buy",
    sell: "Sell",
    marketPrice: "Market Price",
    limitPrice: "Limit Price",
    shares: "Shares",
    placeholderShares: "Enter quantity",
    price: "Price",
    placeholderLimitPrice: "Enter limit price",
    status: "Status",
    filled: "Filled",
    waitingFill: "Waiting",
    limitTooHigh: "Limit price cannot be higher than current price",
    limitTooLow: "Limit price cannot be lower than current price",
    bottomNote: "(This is the bottom navigation)",
    orderSubmitted: "Order submitted",
    successBuy: "Buy successful",
    sellRestrictedBeforeListing: "Sell restricted before listing",
    // Trades panel
    trades: "Trades",
    tradesEmpty: "No trades",
    buyTime: "Buy Time",
    sellTime: "Sell Time",
    amount: "Amount",
    side: "Side",
    time: "Time",
    close: "Close",

    // 404
    notFoundTitle: "404",
    notFoundDesc: "Page not found",
    
    // Kçº¿å›¾ç›¸å…³
    klineOpen: "Open",
    klineHigh: "High",
    klineLow: "Low",
    klineClose: "Close",
    klineVolume: "Volume",
    klineCandlestick: "Candlestick",
    klineLine: "Line",
    klineFullscreen: "Fullscreen",
    klineSettings: "Settings",
    // Settings page labels
    nameLabel: "Name",
    phoneLabel: "Phone",
    loginPwdLabel: "Login Password",
    tradePwdLabel: "Trade PIN",
    kycTitle: "Verification",
    languageLabel: "Language",
    changeLabel: "Change",
    settingsTitle: "Account Settings",
    // Settings extras
    btnBackProfile: "Back to Profile",
    // Institution page
    institutionTitle: "Institutional Account",
    institutionDesc: "Manage corporate accounts: KYC, limits, permissions, and contacts.",
    institutionOrgName: "Company",
    institutionOrgIntro: "Organization introduction",
    institutionFundsTitle: "Account Funds",
    institutionEntriesTitle: "Quick Entries",
    institutionBankEntry: "Banks",
    institutionTradeEntry: "Trading",
    institutionIPOEntry: "IPO",
    institutionSecurityEntry: "Security",
    institutionKycTitle: "KYC Status",
    institutionKycPending: "Pending verification",
    institutionKycVerified: "Verified",
    institutionFeatureFund: "Fund",
    institutionFeatureBlock: "Block Trade",
    institutionFeatureIPORWA: "IPO/RWA",
    institutionTabHoldings: "Current Holdings",
    institutionTabCompleted: "Completed",
    btnRequestUpgrade: "Request Upgrade",
    btnAddContact: "Add Contact",
    labelCorporateName: "Company",
    changeNameTitle: "Change name",
    currentPassword: "Current password",
    confirm: "Confirm",
    saving: "Saving...",
    changeTradePinTitle: "Change trade PIN",
    verifyWithLoginPassword: "Enter login password to verify",
    placeholderNewPin: "New PIN",
    chooseLanguage: "Choose language",
    langSwitchInstant: "Takes effect immediately",
    langSpanish: "Spanish",
    langEnglish: "English",
    // Settings error/success
    errorNameLength: "Name must be 2-20 characters",
    successNameUpdated: "Name updated",
    errorNameSaveFailed: "Failed to save name, please retry",
    errorOldPasswordWrong: "Old password is incorrect",
    errorNewPasswordLength: "New password must be at least 6 characters",
    successLoginPasswordUpdated: "Login password updated",
    errorLoginPasswordUpdate: "Failed to update login password",
    errorLoginVerifyFailed: "Login password verification failed",
    errorTradePinLength: "Trade PIN must be 6 digits",
    successTradePinUpdated: "Trade PIN updated",
    errorTradePinUpdate: "Failed to update trade PIN",
    // Settings modal hints
    hintLoginPwdModal: "New password must be at least 6 characters.",
    hintTradePinModal: "6-digit PIN, verify with login password.",

    // Bank cards
    bankCardsTitle: "Linked Bank Cards",
    bankCardsDesc: "Manage your cards for withdrawals only.",
    bankCardsHint: "For withdrawals only; not for online payments.",
    addBankCard: "Add Card",
    cardNumber: "Card Number/CLABE",
    holderName: "Card Holder",
    bankName: "Bank",
    placeholderCardNumber: "Enter card number/CLABE",
    placeholderHolderName: "Enter holder name here",
    placeholderBankName: "Enter bank name here",
    hintBankNameInput: "",
    addCardHint: "Enter card number/CLABE (15, 16, or 18 digits).",
    
    errorCardNumber: "Invalid number (Mexico: 15, 16, or 18 digits)",
    errorHolderName: "Invalid holder name",
    errorBankName: "Please select a bank",
    successCardAdded: "Card added",
    edit: "Edit",
    delete: "Delete",
    confirmDeleteTitle: "Confirm Delete",
    confirmDeleteDesc: "Do you want to delete this card?",
    confirmYes: "Yes",
    confirmNo: "No",
    successCardUpdated: "Card updated",
    successCardDeleted: "Card deleted",
    errorUpdateFailed: "Update failed",
    errorDeleteFailed: "Delete failed",

    // Wallet addresses
    walletsTitle: "Wallet Address",
    walletsDesc: "Bind your crypto wallet address for withdrawals",
    walletAddressLabel: "Address",
    walletsListTitle: "Saved addresses",
    // Wallet relaxed validation prompts
    errorInvalidAddress: "Invalid address (must be non-empty)",
    editAddressPrompt: "Edit address",
    editNetworkPrompt: "Network (ERC20/TRC20)",
    confirmDeleteAddress: "Delete this address?",
    // Global error and chart translations
    globalErrorTitle: "Error Occurred",
    errorUnknown: "Unknown error",
    btnRetry: "Retry",
    btnClearCacheReload: "Clear Cache & Reload",
    chartInitializing: "Initializing chart...",
    chartUnavailableTitle: "Chart Data Unavailable",
    chartUnavailableMessage: "The symbol or chart data is temporarily unavailable.",
    btnTryYahoo: "Try Yahoo Finance",
    fallbackReasonYahooMexico: "ðŸ“Š Using Yahoo Finance data (Mexico stocks dedicated source)",
    fallbackReasonYahooUnavailable: "ðŸ“Š Using Yahoo Finance data (TradingView unavailable)",
    fallbackReasonNativeFallback: "ðŸ“Š Using native chart (fell back from TradingView)",
    btnTryTradingView: "Try TradingView",
    // Market table headings
    biggestUpsideTitle: "Biggest Upside",
    trend: "Trend",
    change24h: "Change 24h",
    volume: "Volume",
    // --- Institution page (new keys used by /me/institution) ---
    instTitle: "Institutional Account",
    instIntro: "Organization introduction placeholder",
    instOrgNameDefault: "Organization Name",
    instOrgDescDefault: "Organization introduction",
    instFunds: "Fund",
    instBlocks: "Block Trade",
    instIpoRwa: "IPO/RWA",
    instPositionsCurrent: "Current Holdings",
    instPositionsDone: "Completed",
    instPositionsEmpty: "No data yet",
    // Locking
    locked: "Locked",
    lock: "Lock",
    unlock: "Unlock",
    lockSuccess: "Locked",
    unlockSuccess: "Unlocked",
    lockFailed: "Lock failed",
    unlockFailed: "Unlock failed",
    // Invite code modal
    inviteTitle: "Enter your institution invite code",
    invitePlaceholder: "Enter invite code",
    inviteCancel: "Cancel",
    inviteSubmit: "Submit",
    inviteInvalid: "Invalid code",
    inviteAlready: "Already unlocked",
  },
  zh: {
    appLang: "ä¸­æ–‡",
    withdrawTitle: "æçŽ°",
    currencyLabel: "å¸ç§",
    bankCardLabel: "é“¶è¡Œå¡",
    usdtAddressLabel: "USDTåœ°å€",
    networkLabel: "ç½‘ç»œ",
    amountLabel: "é‡‘é¢",
    btnSubmitWithdraw: "æäº¤æçŽ°",
    btnBackProfile: "è¿”å›žä¸ªäººä¸­å¿ƒ",
    withdrawRecordsTitle: "æçŽ°è®°å½•",
    tableTime: "æ—¶é—´",
    tableCurrency: "å¸ç§",
    tableAmount: "é‡‘é¢",
    tableStatus: "çŠ¶æ€",
    tableActions: "æ“ä½œ",
    tableNoRecords: "æš‚æ— è®°å½•",
    btnCancel: "å–æ¶ˆ",
    statusPending: "å¾…å®¡æ ¸",
    statusProcessing: "å¤„ç†ä¸­",
    statusCompleted: "å·²å®Œæˆ",
    statusRejected: "å·²é©³å›ž",
  },
};

export const LanguageContext = createContext({ lang: "es", t: (k) => k, setLang: () => {} });

export function LanguageProvider({ children }) {
  const [lang, setLang] = useState(() => {
    const saved = localStorage.getItem("lang");
    if (saved === "en") return "en";
    if (saved === "zh") return "zh";
    return "es"; // default to Spanish (Mexico)
  });

  useEffect(() => {
    localStorage.setItem("lang", lang);
    document.documentElement.lang = lang === "es" ? "es-MX" : (lang === "zh" ? "zh-CN" : "en");
  }, [lang]);

  const t = useMemo(() => {
    const dict = translations[lang] || translations.es;
    return (key) => dict[key] ?? key;
  }, [lang]);

  const value = useMemo(() => ({ lang, setLang, t }), [lang, t]);
  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useI18n() {
  return useContext(LanguageContext);
}
